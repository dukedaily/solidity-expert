
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>第9节:day2-v3存储 · HonKit</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 3.7.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-page-toc-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="day3-01-交易原理.html" />
    
    
    <link rel="prev" href="day2-01-v2挖矿.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../Moledao.html">
            
                <a href="../Moledao.html">
            
                    
                    加入MoleDAO👏👏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../">
            
                <a href="../">
            
                    
                    扫码入群
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../SUMMARY.html">
            
                <a href="../SUMMARY.html">
            
                    
                    课程目录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../思维导图.html">
            
                <a href="../思维导图.html">
            
                    
                    思维导图
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../00_blockchain基础/">
            
                <a href="../00_blockchain基础/">
            
                    
                    第0章:blockchain基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../00_blockchain基础/01_什么是区块链.html">
            
                <a href="../00_blockchain基础/01_什么是区块链.html">
            
                    
                    第1节:什么是区块链
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../00_blockchain基础/02_什么是比特币.html">
            
                <a href="../00_blockchain基础/02_什么是比特币.html">
            
                    
                    第2节:什么是比特币
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../00_blockchain基础/03_什么是以太坊.html">
            
                <a href="../00_blockchain基础/03_什么是以太坊.html">
            
                    
                    第3节:什么是以太坊
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../00_blockchain基础/04_App与Dapp.html">
            
                <a href="../00_blockchain基础/04_App与Dapp.html">
            
                    
                    第4节:App与Dapp异同
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../00_blockchain基础/05_DAPP技术栈.html">
            
                <a href="../00_blockchain基础/05_DAPP技术栈.html">
            
                    
                    第5节:DAPP技术栈
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../00_blockchain基础/06_web3优质学习资源.html">
            
                <a href="../00_blockchain基础/06_web3优质学习资源.html">
            
                    
                    第6节:web3优质学习资源
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../00_blockchain基础/07_钱包与地址.html">
            
                <a href="../00_blockchain基础/07_钱包与地址.html">
            
                    
                    第7节:钱包与地址
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../00_blockchain基础/08_Remix教程.html">
            
                <a href="../00_blockchain基础/08_Remix教程.html">
            
                    
                    第8节:Remix教程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../00_blockchain基础/09_区块链就业.html">
            
                <a href="../00_blockchain基础/09_区块链就业.html">
            
                    
                    第9节:区块链就业
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../00_blockchain基础/10_solidity岗位要求.html">
            
                <a href="../00_blockchain基础/10_solidity岗位要求.html">
            
                    
                    第10节:solidity岗位要求
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../00_blockchain基础/11_rpc节点.html">
            
                <a href="../00_blockchain基础/11_rpc节点.html">
            
                    
                    第11节:rpc节点
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../00_blockchain基础/12_以太坊白皮书.md">
            
                <span>
            
                    
                    第12节:以太坊白皮书
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../00_blockchain基础/13_如何参与.html">
            
                <a href="../00_blockchain基础/13_如何参与.html">
            
                    
                    第13节:如何参与
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../00_blockchain基础/14_EIP.html">
            
                <a href="../00_blockchain基础/14_EIP.html">
            
                    
                    第14节:EIP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../01_solidity基础/">
            
                <a href="../01_solidity基础/">
            
                    
                    第一章:solidity基础
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../01_solidity基础/01_helloworld.html">
            
                <a href="../01_solidity基础/01_helloworld.html">
            
                    
                    第1节:helloworld
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../01_solidity基础/02_第一个dapp.html">
            
                <a href="../01_solidity基础/02_第一个dapp.html">
            
                    
                    第2节:第一个dapp
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../01_solidity基础/03_基础数据类型.html">
            
                <a href="../01_solidity基础/03_基础数据类型.html">
            
                    
                    第3节:基础数据类型
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../01_solidity基础/04_变量variables.html">
            
                <a href="../01_solidity基础/04_变量variables.html">
            
                    
                    第4节:变量variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../01_solidity基础/05_常量constant.html">
            
                <a href="../01_solidity基础/05_常量constant.html">
            
                    
                    第5节:常量constant
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../01_solidity基础/06_不可变量immutable.html">
            
                <a href="../01_solidity基础/06_不可变量immutable.html">
            
                    
                    第6节:不可变量immutable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../01_solidity基础/07_读写状态变量.html">
            
                <a href="../01_solidity基础/07_读写状态变量.html">
            
                    
                    第7节:读写状态变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../01_solidity基础/08_ether和wei.html">
            
                <a href="../01_solidity基础/08_ether和wei.html">
            
                    
                    第8节:ether和wei
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../01_solidity基础/09_gas和gasprice.html">
            
                <a href="../01_solidity基础/09_gas和gasprice.html">
            
                    
                    第9节:gas和gasprice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../01_solidity基础/10_ifElse.html">
            
                <a href="../01_solidity基础/10_ifElse.html">
            
                    
                    第10节:ifElse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../01_solidity基础/11_forWhileLoop.html">
            
                <a href="../01_solidity基础/11_forWhileLoop.html">
            
                    
                    第11节:forWhileLoop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../01_solidity基础/12_bytes和string.html">
            
                <a href="../01_solidity基础/12_bytes和string.html">
            
                    
                    第12节:bytes和string
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../01_solidity基础/13_映射Mapping.html">
            
                <a href="../01_solidity基础/13_映射Mapping.html">
            
                    
                    第13节:映射Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../01_solidity基础/14_数组Array.html">
            
                <a href="../01_solidity基础/14_数组Array.html">
            
                    
                    第14节:数组Array
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../01_solidity基础/15_枚举Enum.html">
            
                <a href="../01_solidity基础/15_枚举Enum.html">
            
                    
                    第15节:枚举Enum
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../01_solidity基础/16_结构体Struct.html">
            
                <a href="../01_solidity基础/16_结构体Struct.html">
            
                    
                    第16节:结构体Struct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../01_solidity基础/17_memory_storage_calldata.html">
            
                <a href="../01_solidity基础/17_memory_storage_calldata.html">
            
                    
                    第17节:storage_calldata
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../01_solidity基础/18_函数Function.html">
            
                <a href="../01_solidity基础/18_函数Function.html">
            
                    
                    第18节:函数Function
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../01_solidity基础/19_view和pure.html">
            
                <a href="../01_solidity基础/19_view和pure.html">
            
                    
                    第19节:view和pure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.20" data-path="../01_solidity基础/20_error.html">
            
                <a href="../01_solidity基础/20_error.html">
            
                    
                    第20节:error
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.21" data-path="../01_solidity基础/21_修饰器modifier.html">
            
                <a href="../01_solidity基础/21_修饰器modifier.html">
            
                    
                    第21节:修饰器modifier
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.22" data-path="../01_solidity基础/22_事件Event.html">
            
                <a href="../01_solidity基础/22_事件Event.html">
            
                    
                    第22节:事件Event
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.23" data-path="../01_solidity基础/23_继承的方法_重写.html">
            
                <a href="../01_solidity基础/23_继承的方法_重写.html">
            
                    
                    第23节:继承的方法_重写
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.24" data-path="../01_solidity基础/24_继承状态变量_覆盖.html">
            
                <a href="../01_solidity基础/24_继承状态变量_覆盖.html">
            
                    
                    第24节:继承状态变量_覆盖
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.25" data-path="../01_solidity基础/25_构造函数.html">
            
                <a href="../01_solidity基础/25_构造函数.html">
            
                    
                    第25节:构造函数
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.26" data-path="../01_solidity基础/26_可见性visibility.html">
            
                <a href="../01_solidity基础/26_可见性visibility.html">
            
                    
                    第26节:可见性visibility
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.27" data-path="../01_solidity基础/27_abstract.html">
            
                <a href="../01_solidity基础/27_abstract.html">
            
                    
                    第27节:abstract
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.28" data-path="../01_solidity基础/28_interface.html">
            
                <a href="../01_solidity基础/28_interface.html">
            
                    
                    第28节:interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.29" data-path="../01_solidity基础/29_library.html">
            
                <a href="../01_solidity基础/29_library.html">
            
                    
                    第29节:library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.30" data-path="../01_solidity基础/30_传递结构体.html">
            
                <a href="../01_solidity基础/30_传递结构体.html">
            
                    
                    第30节:传递结构体
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../02_solidity进阶/">
            
                <a href="../02_solidity进阶/">
            
                    
                    第二章:solidity进阶
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../02_solidity进阶/01_全局变量.html">
            
                <a href="../02_solidity进阶/01_全局变量.html">
            
                    
                    第1节:全局变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../02_solidity进阶/02_msg三人组.html">
            
                <a href="../02_solidity进阶/02_msg三人组.html">
            
                    
                    第2节:msg三人组
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../02_solidity进阶/03_payable.html">
            
                <a href="../02_solidity进阶/03_payable.html">
            
                    
                    第3节:payable
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../02_solidity进阶/04_encode_encodePacked.html">
            
                <a href="../02_solidity进阶/04_encode_encodePacked.html">
            
                    
                    第4节:encode_encodePacked
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../02_solidity进阶/05_call&staticcall.html">
            
                <a href="../02_solidity进阶/05_call&staticcall.html">
            
                    
                    第5节:call&staticcall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../02_solidity进阶/06_keccak256.html">
            
                <a href="../02_solidity进阶/06_keccak256.html">
            
                    
                    第6节:keccak256
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../02_solidity进阶/07_selector.html">
            
                <a href="../02_solidity进阶/07_selector.html">
            
                    
                    第7节:selector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../02_solidity进阶/08_send_ether.html">
            
                <a href="../02_solidity进阶/08_send_ether.html">
            
                    
                    第8节:send_ether
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.9" data-path="../02_solidity进阶/09_delegatecall.html">
            
                <a href="../02_solidity进阶/09_delegatecall.html">
            
                    
                    第9节:delegatecall
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.10" data-path="../02_solidity进阶/10_fallback.html">
            
                <a href="../02_solidity进阶/10_fallback.html">
            
                    
                    第10节:fallback
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.11" data-path="../02_solidity进阶/11_合约间调用.html">
            
                <a href="../02_solidity进阶/11_合约间调用.html">
            
                    
                    第11节:合约间调用
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.12" data-path="../02_solidity进阶/12_new_create2.html">
            
                <a href="../02_solidity进阶/12_new_create2.html">
            
                    
                    第12节:new_create2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.13" data-path="../02_solidity进阶/13_delete.html">
            
                <a href="../02_solidity进阶/13_delete.html">
            
                    
                    第13节:delete
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.14" data-path="../02_solidity进阶/14_try_catch.html">
            
                <a href="../02_solidity进阶/14_try_catch.html">
            
                    
                    第14节:try_catch
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.15" data-path="../02_solidity进阶/15_import.html">
            
                <a href="../02_solidity进阶/15_import.html">
            
                    
                    第15节:import
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.16" data-path="../02_solidity进阶/16_节约gas.html">
            
                <a href="../02_solidity进阶/16_节约gas.html">
            
                    
                    第16节:节约gas
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.17" data-path="../02_solidity进阶/17_type.html">
            
                <a href="../02_solidity进阶/17_type.html">
            
                    
                    第17节:type
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.18" data-path="../02_solidity进阶/18_assembly.html">
            
                <a href="../02_solidity进阶/18_assembly.html">
            
                    
                    第18节:assembly
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.19" data-path="../02_solidity进阶/19_merkleTree.html">
            
                <a href="../02_solidity进阶/19_merkleTree.html">
            
                    
                    第19节:merkleTree
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.20" data-path="../02_solidity进阶/20_signature.html">
            
                <a href="../02_solidity进阶/20_signature.html">
            
                    
                    第20节:signature
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.21" data-path="../02_solidity进阶/21_permit.html">
            
                <a href="../02_solidity进阶/21_permit.html">
            
                    
                    第21节:permit
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.22" data-path="../02_solidity进阶/22_math.html">
            
                <a href="../02_solidity进阶/22_math.html">
            
                    
                    第22节:math
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.23" data-path="../02_solidity进阶/23_timelock.html">
            
                <a href="../02_solidity进阶/23_timelock.html">
            
                    
                    第23节:timelock
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.24" data-path="../02_solidity进阶/24_upgrade.html">
            
                <a href="../02_solidity进阶/24_upgrade.html">
            
                    
                    第24节:upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.25" data-path="../02_solidity进阶/25_eventLog.html">
            
                <a href="../02_solidity进阶/25_eventLog.html">
            
                    
                    第25节:eventLog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.26" data-path="../02_solidity进阶/26_selfdestruct.html">
            
                <a href="../02_solidity进阶/26_selfdestruct.html">
            
                    
                    第26节:selfdestruct
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.27" data-path="../02_solidity进阶/27_permit2.html">
            
                <a href="../02_solidity进阶/27_permit2.html">
            
                    
                    第27节:permit2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.28" data-path="../02_solidity进阶/28_signature-eip712.html">
            
                <a href="../02_solidity进阶/28_signature-eip712.html">
            
                    
                    第28节:signature-eip712
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../03_token协议/">
            
                <a href="../03_token协议/">
            
                    
                    第三章:token协议
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../03_token协议/01_ERC20.html">
            
                <a href="../03_token协议/01_ERC20.html">
            
                    
                    第1节:ERC20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../03_token协议/02_ERC721.html">
            
                <a href="../03_token协议/02_ERC721.html">
            
                    
                    第2节:ERC721
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../03_token协议/03_ERC1155.html">
            
                <a href="../03_token协议/03_ERC1155.html">
            
                    
                    第3节:ERC1155
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../03_token协议/04_ERC165.html">
            
                <a href="../03_token协议/04_ERC165.html">
            
                    
                    第4节:ERC165
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../03_token协议/05_EIP2612.html">
            
                <a href="../03_token协议/05_EIP2612.html">
            
                    
                    第5节:EIP2612
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../03_token协议/06_EIP712.html">
            
                <a href="../03_token协议/06_EIP712.html">
            
                    
                    第6节:EIP712
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../03_token协议/07_ERC5114_SBT.html">
            
                <a href="../03_token协议/07_ERC5114_SBT.html">
            
                    
                    第7节:ERC5114_SBT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="../03_token协议/08_ERC1820.html">
            
                <a href="../03_token协议/08_ERC1820.html">
            
                    
                    第8节:ERC1820
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9" data-path="../03_token协议/09_metaverse.html">
            
                <a href="../03_token协议/09_metaverse.html">
            
                    
                    第9节:狗屁Metaverse
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="../03_token协议/10_NFT理念探讨.html">
            
                <a href="../03_token协议/10_NFT理念探讨.html">
            
                    
                    第10节:NFT理念探讨
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../04_合约攻击/">
            
                <a href="../04_合约攻击/">
            
                    
                    第四章:合约攻击
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../04_合约攻击/01_重入攻击.html">
            
                <a href="../04_合约攻击/01_重入攻击.html">
            
                    
                    第1节:重入攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../04_合约攻击/02_返回值校验.html">
            
                <a href="../04_合约攻击/02_返回值校验.html">
            
                    
                    第2节:返回值校验
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../04_合约攻击/03_合约自杀导致Dos.html">
            
                <a href="../04_合约攻击/03_合约自杀导致Dos.html">
            
                    
                    第3节:合约自杀导致Dos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../04_合约攻击/04_读取私有变量.html">
            
                <a href="../04_合约攻击/04_读取私有变量.html">
            
                    
                    第4节:读取私有变量
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../04_合约攻击/11_安全事故1-poly网络哈希碰撞攻击.html">
            
                <a href="../04_合约攻击/11_安全事故1-poly网络哈希碰撞攻击.html">
            
                    
                    第11节:安全事故1-poly网络哈希碰撞攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../04_合约攻击/12_安全事故2-OP代币重放攻击.html">
            
                <a href="../04_合约攻击/12_安全事故2-OP代币重放攻击.html">
            
                    
                    第12节:安全事故2-OP代币重放攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../04_合约攻击/13_安全事故3-FTX因免手续费提币攻击.html">
            
                <a href="../04_合约攻击/13_安全事故3-FTX因免手续费提币攻击.html">
            
                    
                    第13节:安全事故3-FTX因免手续费提币攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../04_合约攻击/14_安全事故4-profanity弱随机数暴力破解攻击.html">
            
                <a href="../04_合约攻击/14_安全事故4-profanity弱随机数暴力破解攻击.html">
            
                    
                    第14节:安全事故4-profanity弱随机数暴力破解攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../04_合约攻击/15_安全事故5-出块相关攻击.html">
            
                <a href="../04_合约攻击/15_安全事故5-出块相关攻击.html">
            
                    
                    第15节:安全事故5-出块相关攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../04_合约攻击/16_安全事故6-msgvalue持久化问题.html">
            
                <a href="../04_合约攻击/16_安全事故6-msgvalue持久化问题.html">
            
                    
                    第16节:安全事故6-msgvalue持久化问题
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../04_合约攻击/17_安全事故7-用EOA来call方法攻击.html">
            
                <a href="../04_合约攻击/17_安全事故7-用EOA来call方法攻击.html">
            
                    
                    第17节:安全事故7-用EOA来call方法攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../04_合约攻击/18_安全事故8-可燃烧代币攻击.html">
            
                <a href="../04_合约攻击/18_安全事故8-可燃烧代币攻击.html">
            
                    
                    第18节:安全事故8-可燃烧代币攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.13" data-path="../04_合约攻击/19_安全事故9-签名验证攻击.html">
            
                <a href="../04_合约攻击/19_安全事故9-签名验证攻击.html">
            
                    
                    第19节:安全事故9-签名验证攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.14" data-path="../04_合约攻击/20_安全事故10-delegatecall攻击.html">
            
                <a href="../04_合约攻击/20_安全事故10-delegatecall攻击.html">
            
                    
                    第20节:安全事故10-delegatecall攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.15" data-path="../04_合约攻击/21_安全事故11-tx.origin攻击.html">
            
                <a href="../04_合约攻击/21_安全事故11-tx.origin攻击.html">
            
                    
                    第21节:安全事故11-tx.origin攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.16" data-path="../04_合约攻击/22_安全事故12-DOS攻击.html">
            
                <a href="../04_合约攻击/22_安全事故12-DOS攻击.html">
            
                    
                    第22节:安全事故12-DOS攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.17" data-path="../04_合约攻击/23_安全事故13-encodePacked攻击.html">
            
                <a href="../04_合约攻击/23_安全事故13-encodePacked攻击.html">
            
                    
                    第23节:安全事故13-encodePacked攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.18" data-path="../04_合约攻击/24_安全事故14-短地址攻击.html">
            
                <a href="../04_合约攻击/24_安全事故14-短地址攻击.html">
            
                    
                    第24节:安全事故14-短地址攻击
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.19" data-path="../04_合约攻击/30_智能合约编写一般原则.html">
            
                <a href="../04_合约攻击/30_智能合约编写一般原则.html">
            
                    
                    第30节:智能合约编写一般原则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.20" data-path="../04_合约攻击/31_智能合约编写系统规则.html">
            
                <a href="../04_合约攻击/31_智能合约编写系统规则.html">
            
                    
                    第31节:智能合约编写系统规则
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.21" data-path="../04_合约攻击/32_智能合约编写最佳实践.html">
            
                <a href="../04_合约攻击/32_智能合约编写最佳实践.html">
            
                    
                    第32节:智能合约编写最佳实践
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.22" data-path="../04_合约攻击/33_Solgraph.html">
            
                <a href="../04_合约攻击/33_Solgraph.html">
            
                    
                    第33节:Solgraph
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.23" data-path="../04_合约攻击/34_Mythril.html">
            
                <a href="../04_合约攻击/34_Mythril.html">
            
                    
                    第34节:Mythril
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.24" data-path="../04_合约攻击/35_Slither.html">
            
                <a href="../04_合约攻击/35_Slither.html">
            
                    
                    第35节:Slither
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.25" data-path="../04_合约攻击/36_REMIX静态扫描工具.html">
            
                <a href="../04_合约攻击/36_REMIX静态扫描工具.html">
            
                    
                    第36节:REMIX静态扫描工具
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.26" data-path="../04_合约攻击/37_SECURIF.html">
            
                <a href="../04_合约攻击/37_SECURIF.html">
            
                    
                    第37节:SECURIF
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../05_hardhat框架/">
            
                <a href="../05_hardhat框架/">
            
                    
                    第五章:hardhat框架
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../05_hardhat框架/01_QuickStart.html">
            
                <a href="../05_hardhat框架/01_QuickStart.html">
            
                    
                    第1节:QuickStart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../05_hardhat框架/02_单元测试.html">
            
                <a href="../05_hardhat框架/02_单元测试.html">
            
                    
                    第2节:单元测试
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../05_hardhat框架/03_fork主网.html">
            
                <a href="../05_hardhat框架/03_fork主网.html">
            
                    
                    第3节:fork主网
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../05_hardhat框架/04_多版本编译.html">
            
                <a href="../05_hardhat框架/04_多版本编译.html">
            
                    
                    第4节:多版本编译
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.5" data-path="../05_hardhat框架/05_多网络部署相同地址.html">
            
                <a href="../05_hardhat框架/05_多网络部署相同地址.html">
            
                    
                    第5节:多网络部署相同地址
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../06_ethers/">
            
                <a href="../06_ethers/">
            
                    
                    第六章:ethers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../06_ethers/01_Node.js介绍.html">
            
                <a href="../06_ethers/01_Node.js介绍.html">
            
                    
                    第1节:Node.js介绍
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../07_subgraph/">
            
                <a href="../07_subgraph/">
            
                    
                    第七章:subgraph
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../07_subgraph/00_命令速查.html">
            
                <a href="../07_subgraph/00_命令速查.html">
            
                    
                    第0节:命令速查
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../07_subgraph/01_概述.html">
            
                <a href="../07_subgraph/01_概述.html">
            
                    
                    第1节:概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../07_subgraph/02_实战教程.html">
            
                <a href="../07_subgraph/02_实战教程.html">
            
                    
                    第2节:教程
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../08_项目实战-世界杯竞猜/">
            
                <a href="../08_项目实战-世界杯竞猜/">
            
                    
                    第八章:项目实战-世界杯竞猜
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.13.1" data-path="../08_项目实战-世界杯竞猜/01_世界杯竞猜_solidity.html">
            
                <a href="../08_项目实战-世界杯竞猜/01_世界杯竞猜_solidity.html">
            
                    
                    第1节:世界杯竞猜_solidity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.2" data-path="../08_项目实战-世界杯竞猜/02_世界杯竞猜_hardhat.html">
            
                <a href="../08_项目实战-世界杯竞猜/02_世界杯竞猜_hardhat.html">
            
                    
                    第2节:世界杯竞猜_hardhat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.3" data-path="../08_项目实战-世界杯竞猜/03_世界杯竞猜_ERC20.html">
            
                <a href="../08_项目实战-世界杯竞猜/03_世界杯竞猜_ERC20.html">
            
                    
                    第3节:世界杯竞猜_ERC20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.4" data-path="../08_项目实战-世界杯竞猜/04_世界杯竞猜_subgraph.html">
            
                <a href="../08_项目实战-世界杯竞猜/04_世界杯竞猜_subgraph.html">
            
                    
                    第4节:世界杯竞猜_subgraph
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.5" data-path="../08_项目实战-世界杯竞猜/05-世界杯竞猜_airdrop.html">
            
                <a href="../08_项目实战-世界杯竞猜/05-世界杯竞猜_airdrop.html">
            
                    
                    第5节:世界杯竞猜_airdrop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.6" data-path="../08_项目实战-世界杯竞猜/06_世界杯竞猜_upgrade.html">
            
                <a href="../08_项目实战-世界杯竞猜/06_世界杯竞猜_upgrade.html">
            
                    
                    第6节:世界杯竞猜_upgrade
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.7" data-path="../08_项目实战-世界杯竞猜/07_世界杯竞猜_链下签名.html">
            
                <a href="../08_项目实战-世界杯竞猜/07_世界杯竞猜_链下签名.html">
            
                    
                    第7节:世界杯竞猜_链下签名
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.8" data-path="../08_项目实战-世界杯竞猜/08_世界杯竞猜_多签钱包.html">
            
                <a href="../08_项目实战-世界杯竞猜/08_世界杯竞猜_多签钱包.html">
            
                    
                    第8节:世界杯竞猜_多签钱包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13.9" data-path="../08_项目实战-世界杯竞猜/09_世界杯竞猜_Go交互合约.html">
            
                <a href="../08_项目实战-世界杯竞猜/09_世界杯竞猜_Go交互合约.html">
            
                    
                    第9节:世界杯竞猜_Go交互
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../09_EVM详解/">
            
                <a href="../09_EVM详解/">
            
                    
                    第九章:EVM详解
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.14.1" data-path="../09_EVM详解/01_OPCode手册.html">
            
                <a href="../09_EVM详解/01_OPCode手册.html">
            
                    
                    第1节:OPCode手册
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.2" data-path="../09_EVM详解/02-evm-puzzles.html">
            
                <a href="../09_EVM详解/02-evm-puzzles.html">
            
                    
                    第2节:EVM-PUZZLES挑战
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14.3" data-path="../09_EVM详解/03-汇编概述.html">
            
                <a href="../09_EVM详解/03-汇编概述.html">
            
                    
                    第3节:汇编概述
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../10_EVM反汇编/">
            
                <a href="../10_EVM反汇编/">
            
                    
                    第十章:EVM反汇编
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.15.1" data-path="../10_EVM反汇编/01_反汇编初步了解.html">
            
                <a href="../10_EVM反汇编/01_反汇编初步了解.html">
            
                    
                    第1节:反汇编初步了解
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.2" data-path="../10_EVM反汇编/02_合约部署都做了啥.html">
            
                <a href="../10_EVM反汇编/02_合约部署都做了啥.html">
            
                    
                    第2节:合约部署都做了啥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.3" data-path="../10_EVM反汇编/03_各种类型是如何存储的.html">
            
                <a href="../10_EVM反汇编/03_各种类型是如何存储的.html">
            
                    
                    第3节:各种类型是如何存储的
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.4" data-path="../10_EVM反汇编/04_五种程序终止命令介绍.html">
            
                <a href="../10_EVM反汇编/04_五种程序终止命令介绍.html">
            
                    
                    第4节:五种程序终止命令介绍
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.5" data-path="../10_EVM反汇编/05_function执行流程.html">
            
                <a href="../10_EVM反汇编/05_function执行流程.html">
            
                    
                    第5节:function执行流程
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.6" data-path="../10_EVM反汇编/06_智能合约Layout分析.html">
            
                <a href="../10_EVM反汇编/06_智能合约Layout分析.html">
            
                    
                    第6节:智能合约Layout分析
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15.7" data-path="../10_EVM反汇编/07_合约间调用.html">
            
                <a href="../10_EVM反汇编/07_合约间调用.html">
            
                    
                    第7节:合约间调用
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="./">
            
                <a href="./">
            
                    
                    第十一章:精通比特币
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.16.1" data-path="day1-01-交易演变.html">
            
                <a href="day1-01-交易演变.html">
            
                    
                    第1节:day1-交易演变
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.2" data-path="day1-02-比特币诞生背景.html">
            
                <a href="day1-02-比特币诞生背景.html">
            
                    
                    第2节:day1-比特币诞生背景
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.3" data-path="day1-03-比特币概述.html">
            
                <a href="day1-03-比特币概述.html">
            
                    
                    第3节:day1-比特币概述
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.4" data-path="day1-04-比特币依赖技术.html">
            
                <a href="day1-04-比特币依赖技术.html">
            
                    
                    第4节:day1-比特币依赖技术
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.5" data-path="day1-05-比特币结构.html">
            
                <a href="day1-05-比特币结构.html">
            
                    
                    第5节:day1-比特币结构
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.6" data-path="day1-06-v1链条.html">
            
                <a href="day1-06-v1链条.html">
            
                    
                    第6节:day1-v1链条
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.7" data-path="day1-07-Bitcoin客户端.html">
            
                <a href="day1-07-Bitcoin客户端.html">
            
                    
                    第7节:day1-Bitcoin客户端
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.8" data-path="day2-01-v2挖矿.html">
            
                <a href="day2-01-v2挖矿.html">
            
                    
                    第8节:day2-v2挖矿
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.16.9" data-path="day2-02-v3存储.html">
            
                <a href="day2-02-v3存储.html">
            
                    
                    第9节:day2-v3存储
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.10" data-path="day3-01-交易原理.html">
            
                <a href="day3-01-交易原理.html">
            
                    
                    第10节:day3-交易原理
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.11" data-path="day3-02-v4余额.html">
            
                <a href="day3-02-v4余额.html">
            
                    
                    第11节:day3-v4余额
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.12" data-path="day4-01-v4转账.html">
            
                <a href="day4-01-v4转账.html">
            
                    
                    第12节:day4-v4转账
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.13" data-path="day4-02-v5钱包.html">
            
                <a href="day4-02-v5钱包.html">
            
                    
                    第13节:day4-v5钱包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16.14" data-path="day5-01-v5签名.html">
            
                <a href="day5-01-v5签名.html">
            
                    
                    第14节:day5-v5签名
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../12_精通以太坊/">
            
                <a href="../12_精通以太坊/">
            
                    
                    第十二章:精通以太坊
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.17.1" data-path="../12_精通以太坊/01_以太坊架构.html">
            
                <a href="../12_精通以太坊/01_以太坊架构.html">
            
                    
                    第1节:以太坊架构
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../13_openzeppelin解析/">
            
                <a href="../13_openzeppelin解析/">
            
                    
                    第十三章:openzeppelin解析
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.18.1" data-path="../13_openzeppelin解析/01_accessControl.html">
            
                <a href="../13_openzeppelin解析/01_accessControl.html">
            
                    
                    第1节:AccessControl
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.2" data-path="../13_openzeppelin解析/02_EnumerableSet.html">
            
                <a href="../13_openzeppelin解析/02_EnumerableSet.html">
            
                    
                    第2节:EnumerableSet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.3" data-path="../13_openzeppelin解析/03_EnumerableMap.html">
            
                <a href="../13_openzeppelin解析/03_EnumerableMap.html">
            
                    
                    第3节:EnumerableMap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.4" data-path="../13_openzeppelin解析/04_BitMaps.html">
            
                <a href="../13_openzeppelin解析/04_BitMaps.html">
            
                    
                    第4节:BitMaps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.5" data-path="../13_openzeppelin解析/05_DoubleEndedQueue.html">
            
                <a href="../13_openzeppelin解析/05_DoubleEndedQueue.html">
            
                    
                    第5节:DoubleEndedQueue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.6" data-path="../13_openzeppelin解析/06_ECDSA.html">
            
                <a href="../13_openzeppelin解析/06_ECDSA.html">
            
                    
                    第6节:ECDSA
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.7" data-path="../13_openzeppelin解析/07_SignatureChecker.html">
            
                <a href="../13_openzeppelin解析/07_SignatureChecker.html">
            
                    
                    第7节:SignatureChecker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18.8" data-path="../13_openzeppelin解析/08_EIP712.html">
            
                <a href="../13_openzeppelin解析/08_EIP712.html">
            
                    
                    第8节:EIP712
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="../14_Golang合约交互/">
            
                <a href="../14_Golang合约交互/">
            
                    
                    第十四章:Golang合约交互
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.19.1" data-path="../14_Golang合约交互/01_编译部署合约.html">
            
                <a href="../14_Golang合约交互/01_编译部署合约.html">
            
                    
                    第1节:编译部署合约
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.2" data-path="../14_Golang合约交互/02_读写合约.html">
            
                <a href="../14_Golang合约交互/02_读写合约.html">
            
                    
                    第2节:读写合约
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.3" data-path="../14_Golang合约交互/03_SendTx转账.html">
            
                <a href="../14_Golang合约交互/03_SendTx转账.html">
            
                    
                    第3节:SendTx转账
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.4" data-path="../14_Golang合约交互/04_SendRawTx转账.html">
            
                <a href="../14_Golang合约交互/04_SendRawTx转账.html">
            
                    
                    第4节:SendRawTx转账
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.5" data-path="../14_Golang合约交互/05_订阅事件.html">
            
                <a href="../14_Golang合约交互/05_订阅事件.html">
            
                    
                    第5节:订阅事件
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19.6" data-path="../14_Golang合约交互/06_解析事件.html">
            
                <a href="../14_Golang合约交互/06_解析事件.html">
            
                    
                    第6节:解析事件
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="../15_Golang扫快服务/">
            
                <a href="../15_Golang扫快服务/">
            
                    
                    第十五章:Golang扫快服务
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="../16_uniswapV2解析/">
            
                <a href="../16_uniswapV2解析/">
            
                    
                    第十六章:uniswapV2解析(12月份完成)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.21.1" data-path="../16_uniswapV2解析/00_部署文档.html">
            
                <a href="../16_uniswapV2解析/00_部署文档.html">
            
                    
                    第0节:部署文档
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.2" data-path="../16_uniswapV2解析/01_CORE_V2ERC20.html">
            
                <a href="../16_uniswapV2解析/01_CORE_V2ERC20.html">
            
                    
                    第1节:CORE_V2ERC20
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.3" data-path="../16_uniswapV2解析/02_CORE_V2Factory.html">
            
                <a href="../16_uniswapV2解析/02_CORE_V2Factory.html">
            
                    
                    第2节:CORE_V2Factory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.4" data-path="../16_uniswapV2解析/03_CORE_V2Pair.html">
            
                <a href="../16_uniswapV2解析/03_CORE_V2Pair.html">
            
                    
                    第3节:CORE_V2Pair
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.5" data-path="../16_uniswapV2解析/04_PERIPHERY_ROUTER02.html">
            
                <a href="../16_uniswapV2解析/04_PERIPHERY_ROUTER02.html">
            
                    
                    第4节:PERIPHERY_ROUTER02
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.6" data-path="../16_uniswapV2解析/05_Interface.html">
            
                <a href="../16_uniswapV2解析/05_Interface.html">
            
                    
                    第5节:Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.7" data-path="../16_uniswapV2解析/06_FlashLoan.html">
            
                <a href="../16_uniswapV2解析/06_FlashLoan.html">
            
                    
                    第6节:FlashLoan
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21.8" data-path="../16_uniswapV2解析/07_其他.html">
            
                <a href="../16_uniswapV2解析/07_其他.html">
            
                    
                    第7节:其他
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="../20_热门技术追踪/">
            
                <a href="../20_热门技术追踪/">
            
                    
                    第二十章:热门技术追踪
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.22.1" data-path="../20_热门技术追踪/01_从Layer1到Layer3.html">
            
                <a href="../20_热门技术追踪/01_从Layer1到Layer3.html">
            
                    
                    第1节:从Layer0到Layer3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.2" data-path="../20_热门技术追踪/02_以太坊扩容方案.html">
            
                <a href="../20_热门技术追踪/02_以太坊扩容方案.html">
            
                    
                    第2节:以太坊扩容方案
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.3" data-path="../20_热门技术追踪/04_从HD钱包到MPC钱包.html">
            
                <a href="../20_热门技术追踪/04_从HD钱包到MPC钱包.html">
            
                    
                    第4节:从HD钱包到MPC钱包
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.4" data-path="../20_热门技术追踪/05_跨链桥.html">
            
                <a href="../20_热门技术追踪/05_跨链桥.html">
            
                    
                    第5节:跨链桥
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22.5" data-path="../20_热门技术追踪/06_以太坊POS.html">
            
                <a href="../20_热门技术追踪/06_以太坊POS.html">
            
                    
                    第6节:以太坊POS
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >第9节:day2-v3存储</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
                                <section class="normal markdown-section">
                                
                                <h1 id="概述"><a name="概述" class="plugin-anchor" href="#概述"><i class="fa fa-link" aria-hidden="true"></i></a>概述</h1>
<h2 id="1-当前版本问题"><a name="1-当前版本问题" class="plugin-anchor" href="#1-当前版本问题"><i class="fa fa-link" aria-hidden="true"></i></a>1. 当前版本问题</h2>
<ul>
<li><p>区块在内存中，每次程序执行完就释放，无法重用</p>
</li>
<li><p>创建区块不灵活，在main中写死的，无法随意添加区块</p>
</li>
</ul>
<h2 id="2-v3版本思路"><a name="2-v3版本思路" class="plugin-anchor" href="#2-v3版本思路"><i class="fa fa-link" aria-hidden="true"></i></a>2. V3版本思路</h2>
<ul>
<li><p>bolt数据库的介绍，轻量级的、开源的，key-&gt;value进行读取</p>
</li>
<li><p>BlockChain结构重写，使用数据库代替数组</p>
</li>
<li><p>NewBlockChain函数重写，由对数组操作改写成对数据库操作，创建数据库</p>
</li>
<li><p>AddBlock函数重写，对数据库的读取和写入</p>
</li>
<li><p>打印数据，对数据库的遍历（迭代器Iterator）</p>
</li>
<li><p>命令行介绍及编写、添加区块命令、打印区块链命令、创建区块链（可选）</p>
</li>
</ul>
<h1 id="一、boltdb介绍"><a name="一、boltdb介绍" class="plugin-anchor" href="#一、boltdb介绍"><i class="fa fa-link" aria-hidden="true"></i></a>一、BoltDB介绍</h1>
<h2 id="1-概述"><a name="1-概述" class="plugin-anchor" href="#1-概述"><i class="fa fa-link" aria-hidden="true"></i></a>1. 概述</h2>
<p><img src="assets/image-20221108133234794.png" alt="image-20221108133234794"></p>
<p>每个抽屉相当于一个存储位置，每个抽屉在bolt中的类型为bucket（桶），我们在bucket层面操作数据。</p>
<p><img src="assets/image-20221108133247154.png" alt="image-20221108133247154"></p>
<h2 id="2-demo演示"><a name="2-demo演示" class="plugin-anchor" href="#2-demo演示"><i class="fa fa-link" aria-hidden="true"></i></a>2. demo演示</h2>
<p>下载<a href="https://github.com/boltdb/bolt.git" target="_blank">bolt</a>数据库，放在GOPATH目录下</p>
<p>创建文件boltDemo.go，填写如下内容：</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;bolt&quot;</span>
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

    <span class="hljs-comment">//1. 打开数据库</span>
    db, err := bolt.Open(<span class="hljs-string">&quot;test.db&quot;</span>, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;bolt.Open failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-comment">//2.写数据库</span>
    db.Update(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;firstBucket&quot;</span>))

        <span class="hljs-keyword">var</span> err error
        <span class="hljs-keyword">if</span> bucket == <span class="hljs-literal">nil</span> {
            bucket, err = tx.CreateBucket([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;firstBucket&quot;</span>))
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                fmt.Println(<span class="hljs-string">&quot;createBucket failed!&quot;</span>, err)
                os.Exit(<span class="hljs-number">1</span>)
            }
        }

        bucket.Put([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;aaaa&quot;</span>), []<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;HelloWorld!&quot;</span>))
        bucket.Put([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;bbbb&quot;</span>), []<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;HelloItcast!&quot;</span>))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })

    <span class="hljs-comment">//3.读取数据库</span>
    <span class="hljs-keyword">var</span> value []<span class="hljs-keyword">byte</span>

    db.View(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;firstBucket&quot;</span>))
        <span class="hljs-keyword">if</span> bucket == <span class="hljs-literal">nil</span> {
            fmt.Println(<span class="hljs-string">&quot;Bucket is nil!&quot;</span>)
            os.Exit(<span class="hljs-number">1</span>)
        }

        value = bucket.Get([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;aaaa&quot;</span>))
        fmt.Println(<span class="hljs-string">&quot;aaaa =&gt; &quot;</span>, <span class="hljs-keyword">string</span>(value))
        value = bucket.Get([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">&quot;bbbb&quot;</span>))
        fmt.Println(<span class="hljs-string">&quot;bbbb =&gt; &quot;</span>, <span class="hljs-keyword">string</span>(value))

        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })
}
</code></pre>
<p>编译执行：</p>
<pre><code>go build -o boltDemo boltDemo.go
./boltDemo
</code></pre><h2 id="3分析"><a name="3分析" class="plugin-anchor" href="#3分析"><i class="fa fa-link" aria-hidden="true"></i></a>3.分析</h2>
<p>存储区块，使用的key必须唯一，所以使用区块的hash值作为key，block的字节流作为value。</p>
<p>具体存储格式：</p>
<p><img src="assets/image-20221108133315262.png" alt="image-20221108133315262"></p>
<p>添加一个新区块要做两件事情：</p>
<ul>
<li>添加区块</li>
<li>更新”last“ 这个key对应的值，这个值就是最后一个区块的哈希值，用于新区块的创建添加。</li>
</ul>
<h1 id="二、改写blockchain结构"><a name="二、改写blockchain结构" class="plugin-anchor" href="#二、改写blockchain结构"><i class="fa fa-link" aria-hidden="true"></i></a>二、改写BlockChain结构</h1>
<pre><code class="lang-go"><span class="hljs-comment">//使用bolt改写</span>
<span class="hljs-keyword">type</span> BlockChain <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">//操作数据库的句柄</span>
    db *bolt.DB

    <span class="hljs-comment">//尾巴，存储最后一个区块的哈希</span>
    tail []<span class="hljs-keyword">byte</span>
}
</code></pre>
<h1 id="三、改写newblockchain"><a name="三、改写newblockchain" class="plugin-anchor" href="#三、改写newblockchain"><i class="fa fa-link" aria-hidden="true"></i></a>三、改写NewBlockChain</h1>
<h2 id="1-分析"><a name="1-分析" class="plugin-anchor" href="#1-分析"><i class="fa fa-link" aria-hidden="true"></i></a>1. 分析</h2>
<pre><code class="lang-go"><span class="hljs-comment">//- 提供一个创建BlockChain的方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewBlockChain</span><span class="hljs-params">()</span> *<span class="hljs-title">BlockChain</span></span> {

    <span class="hljs-keyword">var</span> db *bolt.DB
    <span class="hljs-keyword">var</span> lastHash []<span class="hljs-keyword">byte</span>

    <span class="hljs-comment">/*
    1. 打开数据库(没有的话就创建)
    2. 找到抽屉（bucket），如果找到，就返回bucket，如果没有找到，我们要创建bucket，通过名字创建
        a. 找到了
            1. 通过&quot;last&quot;这个key找到我们最好一个区块的哈希。

        b. 没找到创建
            1. 创建bucket，通过名字
            2. 添加创世块数据
            3. 更新&quot;last&quot;这个key的value（创世块的哈希值）
    */</span>

    <span class="hljs-keyword">return</span> &amp;BlockChain{db, lastHash}
}
</code></pre>
<h2 id="2-代码"><a name="2-代码" class="plugin-anchor" href="#2-代码"><i class="fa fa-link" aria-hidden="true"></i></a>2. 代码</h2>
<ol>
<li>确定好返回的两个数据</li>
<li>文字分析步骤</li>
<li>先处理bucket存在逻辑</li>
<li>再处理bucket创建逻辑</li>
<li>不要从boltTest复用代码，重新敲一遍</li>
</ol>
<pre><code class="lang-go"><span class="hljs-comment">//- 提供一个创建BlockChain的方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewBlockChain</span><span class="hljs-params">()</span> *<span class="hljs-title">BlockChain</span></span> {

    <span class="hljs-keyword">var</span> lastHash []<span class="hljs-keyword">byte</span>

    <span class="hljs-comment">/*
    1. 打开数据库(没有的话就创建)
    2. 找到抽屉（bucket），如果找到，就返回bucket，如果没有找到，我们要创建bucket，通过名字创建
        a. 找到了
            1. 通过&quot;last&quot;这个key找到我们最好一个区块的哈希。

        b. 没找到创建
            1. 创建bucket，通过名字
            2. 添加创世块数据
            3. 更新&quot;last&quot;这个key的value（创世块的哈希值）

    */</span>

    db, err := bolt.Open(blockChainDb, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;bolt.Open failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }


    db.Update(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(blockBucket))

        <span class="hljs-keyword">var</span> err error
        <span class="hljs-comment">//如果是空的，表明这个bucket没有创建，我们就要去创建它，然后再写数据。</span>
        <span class="hljs-keyword">if</span> bucket == <span class="hljs-literal">nil</span> {
            bucket, err = tx.CreateBucket([]<span class="hljs-keyword">byte</span>(blockBucket))
            <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                fmt.Println(<span class="hljs-string">&quot;createBucket failed!&quot;</span>, err)
                os.Exit(<span class="hljs-number">1</span>)
            }

            <span class="hljs-comment">//抽屉准备好了，开始写区块数据，区块哪里来？？</span>
            genesisBlock := NewBlock(<span class="hljs-string">&quot;Genesis Block!!!&quot;</span>, []<span class="hljs-keyword">byte</span>{})

            bucket.Put(genesisBlock.Hash, genesisBlock.toByte()<span class="hljs-comment">/*block的字节流！*/</span>) <span class="hljs-comment">//TODO</span>
            bucket.Put([]<span class="hljs-keyword">byte</span>(last), genesisBlock.Hash)

            <span class="hljs-comment">//这个别忘了，我们需要返回它</span>
            lastHash = genesisBlock.Hash
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>

        <span class="hljs-comment">//抽屉已经存在，直接读取即可</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//获取最后一个区块的哈希</span>
            lastHash = bucket.Get([]<span class="hljs-keyword">byte</span>(last))
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })

    <span class="hljs-keyword">return</span> &amp;BlockChain{db, lastHash}
}
</code></pre>
<h1 id="四、序列化反序列化"><a name="四、序列化反序列化" class="plugin-anchor" href="#四、序列化反序列化"><i class="fa fa-link" aria-hidden="true"></i></a>四、序列化/反序列化</h1>
<h2 id="1序列化"><a name="1序列化" class="plugin-anchor" href="#1序列化"><i class="fa fa-link" aria-hidden="true"></i></a>1.序列化</h2>
<p>当交易通过网络传输或在应用程序之间交换时，它们被序列化。 序列化是将内部的数据结构表示转换为可以一次发送一个字节的格式（也称为字节流）的过程。 序列化最常用于编码通过网络传输或用于文件中存储的数据结构。 </p>
<h2 id="2反序列化"><a name="2反序列化" class="plugin-anchor" href="#2反序列化"><i class="fa fa-link" aria-hidden="true"></i></a>2.反序列化</h2>
<p>从交易的字节流表示转换为函数库的内部数据结构表示的过程称为反序列化或交易解析。转换回字节流以通过网络传输、哈希化（hashing）或存储在磁盘上的过程称为序列化。大多数比特币函数库具有用于交易序列化和反序列化的内置函数。</p>
<h2 id="3gob包介绍"><a name="3gob包介绍" class="plugin-anchor" href="#3gob包介绍"><i class="fa fa-link" aria-hidden="true"></i></a>3.gob包介绍</h2>
<p>binary.Write(), binary.Read()</p>
<p>gob是Golang包自带的一个数据结构序列化的编码/解码工具。编码使用Encoder，解码使用Decoder。一种典型的应用场景就是RPC(remote procedure calls)。</p>
<p>gob和json的pack之类的方法一样，由发送端使用Encoder对数据结构进行编码。在接收端收到消息之后，接收端使用Decoder将序列化的数据变化成本地变量。</p>
<ul>
<li><a href="http://www.cnblogs.com/yjf512/archive/2012/08/24/2653697.html" target="_blank">中文参考链接</a></li>
<li><a href="https://golang.org/pkg/encoding/gob/" target="_blank">官方链接</a></li>
</ul>
<h2 id="4demo演示"><a name="4demo演示" class="plugin-anchor" href="#4demo演示"><i class="fa fa-link" aria-hidden="true"></i></a>4.demo演示</h2>
<ul>
<li>定义一个结构Person</li>
<li>使用gob进行序列化（编码）得到字节流</li>
<li>使用gob进行反序列化（解码）得到Person结构</li>
<li><strong>记住，这里所有的结构都用地址传递即可</strong></li>
</ul>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;encoding/gob&quot;</span>
    <span class="hljs-string">&quot;bytes&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
)

<span class="hljs-keyword">type</span> Person <span class="hljs-keyword">struct</span> {
    <span class="hljs-comment">//大写</span>
    Name <span class="hljs-keyword">string</span>
    Age <span class="hljs-keyword">int</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>  {
    <span class="hljs-keyword">var</span> buffer bytes.Buffer
    encoder := gob.NewEncoder(&amp;buffer)

    lily := Person{ <span class="hljs-string">&quot;Lily&quot;</span>, <span class="hljs-number">28</span>}

    err := encoder.Encode(&amp;lily)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;encode failed!&quot;</span>, err)
    }

    fmt.Println(<span class="hljs-string">&quot;after serialize :&quot;</span>, buffer)
    <span class="hljs-keyword">var</span> LILY Person

    decoder := gob.NewDecoder(&amp;buffer)
    err = decoder.Decode(&amp;LILY)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;decode failed!&quot;</span>, err)
    }

    fmt.Println(LILY)
}
</code></pre>
<h2 id="5serialize函数"><a name="5serialize函数" class="plugin-anchor" href="#5serialize函数"><i class="fa fa-link" aria-hidden="true"></i></a>5.Serialize函数</h2>
<pre><code class="lang-go">/序列化:将结构转化成字节流，在网络上按字节传输。
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(block *Block)</span><span class="hljs-title">Serialize</span><span class="hljs-params">()</span> []<span class="hljs-title">byte</span></span> {
    <span class="hljs-comment">//将block数据转换成字节流</span>

    <span class="hljs-keyword">var</span> buffer bytes.Buffer
    <span class="hljs-comment">//创建一个编码器</span>
    encoder := gob.NewEncoder(&amp;buffer)

    <span class="hljs-comment">//编码，将block编码成buffer</span>
    err := encoder.Encode(block)

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;encode failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-keyword">return</span> buffer.Bytes()
}
</code></pre>
<h2 id="6deserialize函数"><a name="6deserialize函数" class="plugin-anchor" href="#6deserialize函数"><i class="fa fa-link" aria-hidden="true"></i></a>6.Deserialize函数</h2>
<pre><code class="lang-go"><span class="hljs-comment">// 反序列化:将接受到的字节流转换成目标结构。</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Deserialize</span><span class="hljs-params">(data []<span class="hljs-keyword">byte</span>)</span> <span class="hljs-title">Block</span></span> {
    <span class="hljs-keyword">var</span> block Block
    <span class="hljs-keyword">var</span> buffer bytes.Buffer

    <span class="hljs-comment">//将data写入buffer</span>
    _, err := buffer.Write(data)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;buffer.Read failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-comment">//创建decoder</span>
    decoder := gob.NewDecoder(&amp;buffer)

    <span class="hljs-comment">//将buffer数据转换成block</span>
    err = decoder.Decode(&amp;block)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;decode failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }

    <span class="hljs-keyword">return</span> block
}
</code></pre>
<h1 id="五、改写addblock"><a name="五、改写addblock" class="plugin-anchor" href="#五、改写addblock"><i class="fa fa-link" aria-hidden="true"></i></a>五、改写AddBlock</h1>
<p>记得两件事，put数据，更新lastHash</p>
<h2 id="1-代码"><a name="1-代码" class="plugin-anchor" href="#1-代码"><i class="fa fa-link" aria-hidden="true"></i></a>1. 代码</h2>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(bc *BlockChain)</span><span class="hljs-title">AddBlock</span><span class="hljs-params">(data <span class="hljs-keyword">string</span>)</span></span>  {

    <span class="hljs-comment">/*
    //获取最后一个区块
    lastBlock := bc.blocks[len(bc.blocks) -1]
    //获取最后一个区块的哈希,作为最新（当前）区块的前哈希
    prevHash := lastBlock.Hash

    block := NewBlock(data, prevHash)
    bc.blocks = append(bc.blocks, &amp;block)
    */</span>

    <span class="hljs-comment">//获取最后区块的哈希值</span>
    lastBlockHash := bc.tail

    <span class="hljs-comment">//创建新区块</span>
    newBlock := NewBlock(data, lastBlockHash)


    bc.db.Update(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(blockBucket))

        <span class="hljs-comment">//如果是空的，表明这个bucket没有创建，我们就要去创建它，然后再写数据。</span>
        <span class="hljs-keyword">if</span> bucket == <span class="hljs-literal">nil</span> {
            fmt.Println(<span class="hljs-string">&quot;bucket should not be nil!!&quot;</span>)
            os.Exit(<span class="hljs-number">1</span>)
        } <span class="hljs-keyword">else</span>{
            <span class="hljs-comment">//添加区块</span>
            bucket.Put(newBlock.Hash, newBlock.toByte()<span class="hljs-comment">/*block的字节流！*/</span>) <span class="hljs-comment">//TODO</span>
            <span class="hljs-comment">//更新最后区块的哈希值</span>
            bucket.Put([]<span class="hljs-keyword">byte</span>(last), newBlock.Hash)

            <span class="hljs-comment">//这个别忘了，我们需要返回它</span>
            bc.tail = newBlock.Hash
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })
}
</code></pre>
<h1 id="六、第一次测试"><a name="六、第一次测试" class="plugin-anchor" href="#六、第一次测试"><i class="fa fa-link" aria-hidden="true"></i></a>六、第一次测试</h1>
<h2 id="1-修改maingo"><a name="1-修改maingo" class="plugin-anchor" href="#1-修改maingo"><i class="fa fa-link" aria-hidden="true"></i></a>1. 修改main.go</h2>
<p>将main函数中的打印部分去掉</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

    bc := NewBlockChain()
    bc.AddBlock(<span class="hljs-string">&quot;HelloWorld!&quot;</span>)
    bc.AddBlock(<span class="hljs-string">&quot;Hello Itcast!&quot;</span>)
    bc.AddBlock(<span class="hljs-string">&quot;Hello i11111!&quot;</span>)
    <span class="hljs-comment">//block的数组</span>
    <span class="hljs-comment">/*
    for index, block := range bc.blocks {
        fmt.Println(&quot; ============== current block index :&quot;, index)
        fmt.Printf(&quot;Version : %d\n&quot;, block.Version)
        fmt.Printf(&quot;PrevBlockHash : %x\n&quot;, block.PrevBlockHash)
        fmt.Printf(&quot;Hash : %x\n&quot;, block.Hash)
        fmt.Printf(&quot;MerkleRoot : %x\n&quot;, block.MerkleRoot)
        fmt.Printf(&quot;TimeStamp : %d\n&quot;, block.TimeStamp)
        fmt.Printf(&quot;Difficuty : %d\n&quot;, block.Difficuty)
        fmt.Printf(&quot;Nonce : %d\n&quot;, block.Nonce)
        fmt.Printf(&quot;Data : %s\n&quot;, block.Data)
        pow := NewProofOfWork(*block)
        fmt.Printf(&quot;IsValid : %v\n&quot;, pow.IsValid())
    }
    */</span>
}
</code></pre>
<h2 id="2-编译执行"><a name="2-编译执行" class="plugin-anchor" href="#2-编译执行"><i class="fa fa-link" aria-hidden="true"></i></a>2. 编译执行</h2>
<pre><code>go build *.go
./block
</code></pre><h2 id="3-执行结果"><a name="3-执行结果" class="plugin-anchor" href="#3-执行结果"><i class="fa fa-link" aria-hidden="true"></i></a>3. 执行结果</h2>
<p><img src="assets/image-20221108133402851.png" alt="image-20221108133402851"></p>
<p>查看当前目录文件，看到数据库文件：</p>
<p><img src="assets/image-20221108133410833.png" alt="image-20221108133410833"></p>
<p>这是个二进制文件，无法直接打开，锁门使用<code>strings</code>命令简单查看一下数据库的内容（后面会详解）</p>
<p><strong>注，strings能够简单查看一些二进制文件，windows没有该命令</strong></p>
<p><img src="assets/image-20221108133425057.png" alt="image-20221108133425057"></p>
<p>如果显示如上信息，那么说明写入数据库成功，恭喜你！</p>
<h1 id="五、迭代器"><a name="五、迭代器" class="plugin-anchor" href="#五、迭代器"><i class="fa fa-link" aria-hidden="true"></i></a>五、迭代器</h1>
<p>迭代器作用：遍历容器，将数据逐个返回，防止一次性加载到内存，所以一点一点读取。</p>
<p>类比：for循环里面range</p>
<p><img src="assets/image-20221108133445947.png" alt="image-20221108133445947"></p>
<p>我们的区块链迭代器图示，最初指向最后一个区块，返回区块，指针前移，直至第一个区块。</p>
<p><img src="assets/image-20221108133457265.png" alt="image-20221108133457265"></p>
<p><img src="assets/image-20221108133510112.png" alt="image-20221108133510112"></p>
<h2 id="0-bolt自带迭代器"><a name="0-bolt自带迭代器" class="plugin-anchor" href="#0-bolt自带迭代器"><i class="fa fa-link" aria-hidden="true"></i></a>0. bolt自带迭代器</h2>
<p><strong>特点：bolt内部使用key的大小进行自动排序，而不是按照插入顺序排序，所以不适用我们的区块打印</strong></p>
<p><strong>请自行验证遍历key打印输出</strong>，代码如下</p>
<pre><code class="lang-js">func (bc *BlockChain) <span class="hljs-function"><span class="hljs-title">Printchain</span>(<span class="hljs-params"></span>)</span> {

    bc.db.View(func(tx *bolt.Tx) error {
        <span class="hljs-comment">// Assume bucket exists and has keys</span>
        <span class="hljs-attr">b</span> := tx.Bucket([]byte(<span class="hljs-string">&quot;blockBucket&quot;</span>))

        <span class="hljs-comment">//从第一个key-&gt; value 进行遍历，到最后一个固定的key时直接返回</span>
        b.ForEach(func(k, v []byte) error {
            <span class="hljs-keyword">if</span> bytes.Equal(k, []byte(<span class="hljs-string">&quot;LastHashKey&quot;</span>)) {
                <span class="hljs-keyword">return</span> nil
            }

            <span class="hljs-attr">block</span> := Deserialize(v)
            <span class="hljs-comment">//fmt.Printf(&quot;key=%x, value=%s\n&quot;, k, v)</span>
            fmt.Printf(<span class="hljs-string">&quot;===========================\n\n&quot;</span>)
            fmt.Printf(<span class="hljs-string">&quot;版本号: %d\n&quot;</span>, block.Version)
            fmt.Printf(<span class="hljs-string">&quot;前区块哈希值: %x\n&quot;</span>, block.PrevHash)
            fmt.Printf(<span class="hljs-string">&quot;梅克尔根: %x\n&quot;</span>, block.MerkelRoot)
            fmt.Printf(<span class="hljs-string">&quot;时间戳: %d\n&quot;</span>, block.TimeStamp)
            fmt.Printf(<span class="hljs-string">&quot;难度值(随便写的）: %d\n&quot;</span>, block.Difficulty)
            fmt.Printf(<span class="hljs-string">&quot;随机数 : %d\n&quot;</span>, block.Nonce)
            fmt.Printf(<span class="hljs-string">&quot;当前区块哈希值: %x\n&quot;</span>, block.Hash)
            fmt.Printf(<span class="hljs-string">&quot;区块数据 :%s\n&quot;</span>, block.Data)
            <span class="hljs-keyword">return</span> nil
        })
        <span class="hljs-keyword">return</span> nil
    })
}
</code></pre>
<h2 id="1-定义迭代器结构"><a name="1-定义迭代器结构" class="plugin-anchor" href="#1-定义迭代器结构"><i class="fa fa-link" aria-hidden="true"></i></a>1. 定义迭代器结构</h2>
<p>我们自定义迭代器，实现区块遍历，决堤步骤：创建文件BlockChainIterator.go，添加如下代码：</p>
<pre><code class="lang-go"><span class="hljs-comment">//1. 定义一个区块链迭代器的结构</span>
<span class="hljs-keyword">type</span> BlockChainIterator <span class="hljs-keyword">struct</span> {
    db *bolt.DB

    <span class="hljs-comment">//指向当前的区块</span>
    current_point []<span class="hljs-keyword">byte</span> 
}
</code></pre>
<h2 id="2-定义迭代器创建函数"><a name="2-定义迭代器创建函数" class="plugin-anchor" href="#2-定义迭代器创建函数"><i class="fa fa-link" aria-hidden="true"></i></a>2. 定义迭代器创建函数</h2>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewBlockChainIterator</span><span class="hljs-params">(bc *BlockChain)</span> <span class="hljs-title">BlockChainIterator</span></span> {

    <span class="hljs-keyword">var</span> it BlockChainIterator

    it.db = bc.db
    it.current_point = bc.tail

    <span class="hljs-keyword">return</span> it
}
</code></pre>
<h2 id="3-定义迭代器访问函数"><a name="3-定义迭代器访问函数" class="plugin-anchor" href="#3-定义迭代器访问函数"><i class="fa fa-link" aria-hidden="true"></i></a>3. 定义迭代器访问函数</h2>
<pre><code class="lang-go"><span class="hljs-comment">//一般叫Next(),迭代器的访问函数</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(it *BlockChainIterator)</span><span class="hljs-title">GetBlockAndMoveLeft</span><span class="hljs-params">()</span> <span class="hljs-title">Block</span></span> {
    <span class="hljs-keyword">var</span> block Block
    <span class="hljs-comment">//1. 获取block</span>
    it.db.View(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(blockBucket))

        <span class="hljs-comment">//如果是空的，报错。</span>
        <span class="hljs-keyword">if</span> bucket == <span class="hljs-literal">nil</span> {
            fmt.Println(<span class="hljs-string">&quot;bucket should not be nil!!&quot;</span>)
            os.Exit(<span class="hljs-number">1</span>)
        } <span class="hljs-keyword">else</span>{

            <span class="hljs-comment">//根据当前的current_pointer获取block</span>
            <span class="hljs-comment">//这是一个字节流，需要反序列化</span>
            current_block_tmp := bucket.Get(it.current_point)
            <span class="hljs-comment">//fmt.Println(&quot;current_block_tmp : &quot;, current_block_tmp)</span>
            current_block := Deserialize(current_block_tmp)

            <span class="hljs-comment">//这就拿到了我们想要的区块数据，准备返回</span>
            block = current_block

            <span class="hljs-comment">//将游标（指针）左移</span>
            <span class="hljs-comment">//2. 向左移动</span>
            it.current_point = current_block.PrevBlockHash
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })


    <span class="hljs-keyword">return</span> block
</code></pre>
<h2 id="4-调用迭代器访问函数"><a name="4-调用迭代器访问函数" class="plugin-anchor" href="#4-调用迭代器访问函数"><i class="fa fa-link" aria-hidden="true"></i></a>4. 调用迭代器访问函数</h2>
<p>直接讲下面的代码替换原main.go内容</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {

    bc := NewBlockChain()
    bc.AddBlock(<span class="hljs-string">&quot;HelloWorld!&quot;</span>)
    bc.AddBlock(<span class="hljs-string">&quot;Hello Itcast!&quot;</span>)
    bc.AddBlock(<span class="hljs-string">&quot;Hello i11111!&quot;</span>)

    <span class="hljs-comment">//定义迭代器</span>
    it := NewBlockChainIterator(bc)

    <span class="hljs-keyword">for</span> {
        <span class="hljs-comment">//调用迭代器访问函数，返回当前block，并且向左移动</span>
        block := it.GetBlockAndMoveLeft()

        fmt.Println(<span class="hljs-string">&quot; ============== =============&quot;</span>)
        fmt.Printf(<span class="hljs-string">&quot;Version : %d\n&quot;</span>, block.Version)
        fmt.Printf(<span class="hljs-string">&quot;PrevBlockHash : %x\n&quot;</span>, block.PrevBlockHash)
        fmt.Printf(<span class="hljs-string">&quot;Hash : %x\n&quot;</span>, block.Hash)
        fmt.Printf(<span class="hljs-string">&quot;MerkleRoot : %x\n&quot;</span>, block.MerkleRoot)
        fmt.Printf(<span class="hljs-string">&quot;TimeStamp : %d\n&quot;</span>, block.TimeStamp)
        fmt.Printf(<span class="hljs-string">&quot;Difficuty : %d\n&quot;</span>, block.Difficuty)
        fmt.Printf(<span class="hljs-string">&quot;Nonce : %d\n&quot;</span>, block.Nonce)
        fmt.Printf(<span class="hljs-string">&quot;Data : %s\n&quot;</span>, block.Data)
        pow := NewProofOfWork(block)
        fmt.Printf(<span class="hljs-string">&quot;IsValid : %v\n&quot;</span>, pow.IsValid())

        <span class="hljs-comment">//终止条件</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(block.PrevBlockHash)  == <span class="hljs-number">0</span> {
            fmt.Println(<span class="hljs-string">&quot;print over!&quot;</span>)
            <span class="hljs-keyword">break</span>
        }
    }
}
</code></pre>
<h1 id="七、第二次测试"><a name="七、第二次测试" class="plugin-anchor" href="#七、第二次测试"><i class="fa fa-link" aria-hidden="true"></i></a>七、第二次测试</h1>
<h2 id="1-编译执行"><a name="1-编译执行" class="plugin-anchor" href="#1-编译执行"><i class="fa fa-link" aria-hidden="true"></i></a>1. 编译执行</h2>
<pre><code>go build *.go
./block
</code></pre><h2 id="2-执行结果"><a name="2-执行结果" class="plugin-anchor" href="#2-执行结果"><i class="fa fa-link" aria-hidden="true"></i></a>2. 执行结果</h2>
<pre><code class="lang-go">duke ~/Desktop/code/v3$  ./block 
target : <span class="hljs-number">100000000000000000000000000000000000000000000000000000000000</span>
found hash : <span class="hljs-number">00000</span>d36d024711a949b9779e4d43a2a18a0707654f491a0f41840ad87f849d8, <span class="hljs-number">3209217</span>
target : <span class="hljs-number">100000000000000000000000000000000000000000000000000000000000</span>
found hash : <span class="hljs-number">00000</span>b552da1df46e5a7e39768b7d34bac2126ac4c0daec840d1e5656e412b3c, <span class="hljs-number">1409047</span>
target : <span class="hljs-number">100000000000000000000000000000000000000000000000000000000000</span>
found hash : <span class="hljs-number">0000054</span>ee9bd49cebe27eaf5ae23c77ba4640c14248814efa0b6323631a0dd9e, <span class="hljs-number">1086036</span>
target : <span class="hljs-number">100000000000000000000000000000000000000000000000000000000000</span>
found hash : <span class="hljs-number">00000</span>a6fddea8ef13c319882077606ae5c27e6ce8c62fb6f2ea2da818f6b8488, <span class="hljs-number">580415</span>
 ============== =============
Version : <span class="hljs-number">0</span>
PrevBlockHash : <span class="hljs-number">0000054</span>ee9bd49cebe27eaf5ae23c77ba4640c14248814efa0b6323631a0dd9e
Hash : <span class="hljs-number">00000</span>a6fddea8ef13c319882077606ae5c27e6ce8c62fb6f2ea2da818f6b8488
MerkleRoot : 
TimeStamp : <span class="hljs-number">1536323781</span>
Difficuty : <span class="hljs-number">10</span>
Nonce : <span class="hljs-number">580415</span>
Data : Hello i11111!
is valid hash : <span class="hljs-number">00000</span>a6fddea8ef13c319882077606ae5c27e6ce8c62fb6f2ea2da818f6b8488, <span class="hljs-number">580415</span>
IsValid : <span class="hljs-literal">true</span>
 ============== =============
Version : <span class="hljs-number">0</span>
PrevBlockHash : <span class="hljs-number">00000</span>b552da1df46e5a7e39768b7d34bac2126ac4c0daec840d1e5656e412b3c
Hash : <span class="hljs-number">0000054</span>ee9bd49cebe27eaf5ae23c77ba4640c14248814efa0b6323631a0dd9e
MerkleRoot : 
TimeStamp : <span class="hljs-number">1536323780</span>
Difficuty : <span class="hljs-number">10</span>
Nonce : <span class="hljs-number">1086036</span>
Data : Hello Itcast!
is valid hash : <span class="hljs-number">0000054</span>ee9bd49cebe27eaf5ae23c77ba4640c14248814efa0b6323631a0dd9e, <span class="hljs-number">1086036</span>
IsValid : <span class="hljs-literal">true</span>
 ============== =============
Version : <span class="hljs-number">0</span>
PrevBlockHash : <span class="hljs-number">00000</span>d36d024711a949b9779e4d43a2a18a0707654f491a0f41840ad87f849d8
Hash : <span class="hljs-number">00000</span>b552da1df46e5a7e39768b7d34bac2126ac4c0daec840d1e5656e412b3c
MerkleRoot : 
TimeStamp : <span class="hljs-number">1536323778</span>
Difficuty : <span class="hljs-number">10</span>
Nonce : <span class="hljs-number">1409047</span>
Data : HelloWorld!
is valid hash : <span class="hljs-number">00000</span>b552da1df46e5a7e39768b7d34bac2126ac4c0daec840d1e5656e412b3c, <span class="hljs-number">1409047</span>
IsValid : <span class="hljs-literal">true</span>
 ============== =============
Version : <span class="hljs-number">0</span>
PrevBlockHash : 
Hash : <span class="hljs-number">00000</span>d36d024711a949b9779e4d43a2a18a0707654f491a0f41840ad87f849d8
MerkleRoot : 
TimeStamp : <span class="hljs-number">1536323775</span>
Difficuty : <span class="hljs-number">10</span>
Nonce : <span class="hljs-number">3209217</span>
Data : Genesis Block!!!
is valid hash : <span class="hljs-number">00000</span>d36d024711a949b9779e4d43a2a18a0707654f491a0f41840ad87f849d8, <span class="hljs-number">3209217</span>
IsValid : <span class="hljs-literal">true</span>
<span class="hljs-built_in">print</span> over!
</code></pre>
<p>至此，对于数据库的操作已经全部完成，接下来就是去添加命令行，休息一会，喝杯茶吧。</p>
<h1 id="八、命令行"><a name="八、命令行" class="plugin-anchor" href="#八、命令行"><i class="fa fa-link" aria-hidden="true"></i></a>八、命令行</h1>
<p>创建命令行文件，填入如下代码，代码比较简单，请仔细分析。</p>
<p>另，这里的实现有些笨重，比如需要反复自己解析os.Args数据，后面版本可以使用flag模块进行优化。</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">&quot;os&quot;</span>
    <span class="hljs-string">&quot;fmt&quot;</span>
)

<span class="hljs-keyword">type</span> CLI <span class="hljs-keyword">struct</span> {
    bc *BlockChain
}

<span class="hljs-keyword">const</span> Usage = <span class="hljs-string">`
    ./blockchain addBlock --data DATA &quot;add a block&quot;
    ./blockchain printChain &quot;print block Chain&quot;
`</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cli *CLI)</span> <span class="hljs-title">Run</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) &lt; <span class="hljs-number">2</span> {
        fmt.Println(Usage)
        os.Exit(<span class="hljs-number">1</span>)
    }

    cmd := os.Args[<span class="hljs-number">1</span>]

    <span class="hljs-keyword">switch</span> cmd {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;addBlock&quot;</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) &gt; <span class="hljs-number">3</span> &amp;&amp; os.Args[<span class="hljs-number">2</span>] == <span class="hljs-string">&quot;--data&quot;</span> {
            data := os.Args[<span class="hljs-number">3</span>]
            <span class="hljs-keyword">if</span> data == <span class="hljs-string">&quot;&quot;</span> {
                fmt.Println(<span class="hljs-string">&quot;data should not be empty!&quot;</span>)
                os.Exit(<span class="hljs-number">1</span>)
            }
            cli.addBlock(data)
        } <span class="hljs-keyword">else</span> {
            fmt.Println(Usage)
        }
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;printChain&quot;</span>:
        cli.printChain()
    <span class="hljs-keyword">default</span>:
        fmt.Println(Usage)
    }
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cli *CLI)</span><span class="hljs-title">addBlock</span><span class="hljs-params">(data <span class="hljs-keyword">string</span>)</span></span>  {
    cli.bc.AddBlock(data)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cli *CLI)</span><span class="hljs-title">printChain</span><span class="hljs-params">()</span></span>  {

    <span class="hljs-comment">//定义迭代器</span>
    it := NewBlockChainIterator(cli.bc)
    <span class="hljs-keyword">for</span> {

        block := it.GetBlockAndMoveLeft()

        fmt.Println(<span class="hljs-string">&quot; ============== =============&quot;</span>)
        fmt.Printf(<span class="hljs-string">&quot;Version : %d\n&quot;</span>, block.Version)
        fmt.Printf(<span class="hljs-string">&quot;PrevBlockHash : %x\n&quot;</span>, block.PrevBlockHash)
        fmt.Printf(<span class="hljs-string">&quot;Hash : %x\n&quot;</span>, block.Hash)
        fmt.Printf(<span class="hljs-string">&quot;MerkleRoot : %x\n&quot;</span>, block.MerkleRoot)
        fmt.Printf(<span class="hljs-string">&quot;TimeStamp : %d\n&quot;</span>, block.TimeStamp)
        fmt.Printf(<span class="hljs-string">&quot;Difficuty : %d\n&quot;</span>, block.Difficuty)
        fmt.Printf(<span class="hljs-string">&quot;Nonce : %d\n&quot;</span>, block.Nonce)
        fmt.Printf(<span class="hljs-string">&quot;Data : %s\n&quot;</span>, block.Data)
        pow := NewProofOfWork(block)
        fmt.Printf(<span class="hljs-string">&quot;IsValid : %v\n&quot;</span>, pow.IsValid())


        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(block.PrevBlockHash)  == <span class="hljs-number">0</span> {
            fmt.Println(<span class="hljs-string">&quot;print over!&quot;</span>)
            <span class="hljs-keyword">break</span>
        }
    }
}
</code></pre>
<p>修改main.go如下，主函数只做基本的调用，其余的都由命令行类进行调度即可，这符合模块化编程。</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    bc := NewBlockChain()
    cli := CLI{bc}
    cli.Run()
}
</code></pre>
<h1 id="九、第三次测试"><a name="九、第三次测试" class="plugin-anchor" href="#九、第三次测试"><i class="fa fa-link" aria-hidden="true"></i></a>九、第三次测试</h1>
<p>编译执行同上。</p>
<p>执行效果如下：</p>
<pre><code class="lang-shell"> duke ~/Desktop/code/v3$  ./block 

        addBlock --data DATA &quot;add a block&quot;
        printChain &quot;print block Chain&quot;
</code></pre>
<p>如果数据库文件不存在，程序会先进行数据库创建，即进行一次挖矿，如下：</p>
<pre><code class="lang-go"> duke ~/Desktop/code/v3$  ./block 
target : <span class="hljs-number">100000000000000000000000000000000000000000000000000000000000</span>
found hash : <span class="hljs-number">00000</span>ae80985ec5ab56873dc5d4efd978a8b418cd50eee17584dda087632fe5f, <span class="hljs-number">62170</span>

        addBlock --data DATA <span class="hljs-string">&quot;add a block&quot;</span>
        printChain <span class="hljs-string">&quot;print block Chain&quot;</span>
</code></pre>
<p>==我们后面会把创建数据库操作也放到命令中去控制。==</p>
<h2 id="1-命令测试"><a name="1-命令测试" class="plugin-anchor" href="#1-命令测试"><i class="fa fa-link" aria-hidden="true"></i></a>1. 命令测试</h2>
<p><img src="assets/image-20221108133559674.png" alt="image-20221108133559674"></p>
<h1 id="十、添加创建数据库命令"><a name="十、添加创建数据库命令" class="plugin-anchor" href="#十、添加创建数据库命令"><i class="fa fa-link" aria-hidden="true"></i></a>十、添加创建数据库命令</h1>
<p>我们来看NewBlockChain这个函数，它其实是有两个功能</p>
<ul>
<li><p>数据库不存在时，创建数据库，并返回当前区块链的一个对象，以便后面操作。</p>
</li>
<li><p>当数据库存在时，直接返回区块链对象，以便后续操作。</p>
</li>
</ul>
<p>如果想实现用命令行创建数据库，那么这两个必须分开成两个函数，分别实现上述的两个功能</p>
<h2 id="1-创建区块链函数newblockchain"><a name="1-创建区块链函数newblockchain" class="plugin-anchor" href="#1-创建区块链函数newblockchain"><i class="fa fa-link" aria-hidden="true"></i></a>1. 创建区块链函数NewBlockChain</h2>
<p>只负责创建，然后便退出程序。</p>
<pre><code class="lang-go"><span class="hljs-comment">//- 提供一个创建BlockChain的方法</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewBlockChain</span><span class="hljs-params">(address <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">BlockChain</span></span> {  <span class="hljs-comment">//&lt;&lt;---添加了创建人的地址，后面会用到</span>
    <span class="hljs-keyword">var</span> lastHash []<span class="hljs-keyword">byte</span>

    db, err := bolt.Open(blockChainDb, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;bolt.Open failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }

    db.Update(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(blockBucket))

        <span class="hljs-keyword">var</span> err error
        bucket, err = tx.CreateBucket([]<span class="hljs-keyword">byte</span>(blockBucket))
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            fmt.Println(<span class="hljs-string">&quot;createBucket failed!&quot;</span>, err)
            os.Exit(<span class="hljs-number">1</span>)
        }

        <span class="hljs-comment">//抽屉准备好了，开始写区块数据，区块哪里来？？</span>
        genesisBlock := NewBlock(<span class="hljs-string">&quot;Genesis Block!!!&quot;</span>, []<span class="hljs-keyword">byte</span>{})

        bucket.Put(genesisBlock.Hash, genesisBlock.Serialize() <span class="hljs-comment">/*block的字节流！*/</span>)
        bucket.Put([]<span class="hljs-keyword">byte</span>(last), genesisBlock.Hash)

        <span class="hljs-comment">//这个哈希此时是没有用的</span>
        lastHash = genesisBlock.Hash
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })

    <span class="hljs-comment">//还是要返回一个实例，便于关闭数据库</span>
    <span class="hljs-keyword">return</span> &amp;BlockChain{db, lastHash}
}
</code></pre>
<h2 id="2-获取区块链对象的函数"><a name="2-获取区块链对象的函数" class="plugin-anchor" href="#2-获取区块链对象的函数"><i class="fa fa-link" aria-hidden="true"></i></a>2. 获取区块链对象的函数</h2>
<p>函数名字为：GetBlockChainObj调用这个方法时，确保区块链已经创建</p>
<pre><code class="lang-go"><span class="hljs-comment">//获取一个区块链实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetBlockChainObj</span><span class="hljs-params">()</span> *<span class="hljs-title">BlockChain</span></span> {

    <span class="hljs-keyword">var</span> lastHash []<span class="hljs-keyword">byte</span>
    db, err := bolt.Open(blockChainDb, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        fmt.Println(<span class="hljs-string">&quot;bolt.Open failed!&quot;</span>, err)
        os.Exit(<span class="hljs-number">1</span>)
    }

    db.View(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(tx *bolt.Tx)</span> <span class="hljs-title">error</span></span> {
        bucket := tx.Bucket([]<span class="hljs-keyword">byte</span>(blockBucket))

        <span class="hljs-keyword">var</span> err error
        <span class="hljs-keyword">if</span> bucket == <span class="hljs-literal">nil</span> {
            fmt.Println(<span class="hljs-string">&quot;bucket should not be nil!&quot;</span>, err)
            os.Exit(<span class="hljs-number">1</span>)

        }

        <span class="hljs-comment">//抽屉已经存在，直接读取即可</span>
        <span class="hljs-comment">//获取最后一个区块的哈希</span>
        lastHash = bucket.Get([]<span class="hljs-keyword">byte</span>(last))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })

    <span class="hljs-keyword">return</span> &amp;BlockChain{db, lastHash}
}
</code></pre>
<h2 id="3-添加数据库文件检查函数"><a name="3-添加数据库文件检查函数" class="plugin-anchor" href="#3-添加数据库文件检查函数"><i class="fa fa-link" aria-hidden="true"></i></a>3. 添加数据库文件检查函数</h2>
<p>如果文件存在就不用创建，如果文件未创建请先创建。</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">dbExists</span><span class="hljs-params">()</span> <span class="hljs-title">bool</span></span> {
    <span class="hljs-keyword">if</span> _, err := os.Stat(blockChainDb); os.IsNotExist(err) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}
</code></pre>
<p>在NewBlockChain中添加代码：</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewBlockChain</span><span class="hljs-params">(address <span class="hljs-keyword">string</span>)</span> *<span class="hljs-title">BlockChain</span></span> {
    <span class="hljs-keyword">var</span> lastHash []<span class="hljs-keyword">byte</span>

    <span class="hljs-keyword">if</span> dbExists() {   <span class="hljs-comment">//&lt;---这里</span>
        fmt.Println(<span class="hljs-string">&quot;blockchain already exist!&quot;</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }

    db, err := bolt.Open(blockChainDb, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)
    ...
</code></pre>
<p>在GetBlockChainObj中添加代码：</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetBlockChainObj</span><span class="hljs-params">()</span> *<span class="hljs-title">BlockChain</span></span> {

    <span class="hljs-keyword">var</span> lastHash []<span class="hljs-keyword">byte</span>

    <span class="hljs-keyword">if</span> !dbExists() {  <span class="hljs-comment">//&lt;---这里</span>
        fmt.Println(<span class="hljs-string">&quot;blockchain not exist, pls create first!&quot;</span>)
        os.Exit(<span class="hljs-number">1</span>)
    }

    db, err := bolt.Open(blockChainDb, <span class="hljs-number">0600</span>, <span class="hljs-literal">nil</span>)
</code></pre>
<h2 id="4修改cli结构"><a name="4修改cli结构" class="plugin-anchor" href="#4修改cli结构"><i class="fa fa-link" aria-hidden="true"></i></a>4.修改CLI结构</h2>
<p>切换到commandLine.go文件</p>
<p>对象无需传递进来，使用一个创建方法提供。</p>
<pre><code class="lang-go"><span class="hljs-keyword">type</span> CLI <span class="hljs-keyword">struct</span> {
   <span class="hljs-comment">//bc *BlockChain</span>
}
</code></pre>
<p>更新Usage</p>
<pre><code class="lang-go"><span class="hljs-keyword">const</span> Usage = <span class="hljs-string">`
    createBlockChain --address ADDRESS &quot;create a blockchian&quot; //&lt;--这里
    addBlock --data DATA &quot;add a block&quot;
    printChain &quot;print block Chain&quot;
`</span>
</code></pre>
<p>添加创建逻辑</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cli *CLI)</span><span class="hljs-title">CreateBlockChain</span><span class="hljs-params">(address <span class="hljs-keyword">string</span>)</span></span> {
    bc := NewBlockChain(address)
    err := bc.db.Close()

    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">//删除数据库</span>
        <span class="hljs-keyword">if</span> dbExists() {
            os.Remove(blockChainDb)
        }
        fmt.Println(<span class="hljs-string">&quot;create blockchain failed!&quot;</span>)
    }

    fmt.Println(<span class="hljs-string">&quot;create blockchain successfully!&quot;</span>)
}
</code></pre>
<p>在switch中添加调用</p>
<pre><code class="lang-go">    <span class="hljs-keyword">switch</span> cmd {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;createBlockChain&quot;</span>:
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(os.Args) &gt; <span class="hljs-number">3</span> &amp;&amp; os.Args[<span class="hljs-number">2</span>] == <span class="hljs-string">&quot;--address&quot;</span> {
            address := os.Args[<span class="hljs-number">3</span>]
            <span class="hljs-keyword">if</span> address == <span class="hljs-string">&quot;&quot;</span> {
                fmt.Println(<span class="hljs-string">&quot;address should not be empty!&quot;</span>)
                os.Exit(<span class="hljs-number">1</span>)
            }
            cli.CreateBlockChain(address)
        } <span class="hljs-keyword">else</span> {
            fmt.Println(Usage)
        }
    <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;addBlock&quot;</span>:
</code></pre>
<p>更新AddBlock命令</p>
<p>此时需要我们调用GetBlockChainObj获取区块链对象</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cli *CLI)</span><span class="hljs-title">addBlock</span><span class="hljs-params">(data <span class="hljs-keyword">string</span>)</span></span>  {
    <span class="hljs-comment">//cli.bc.AddBlock(data)</span>
    bc := GetBlockChainObj()
    bc.AddBlock(data)
    bc.db.Close()
    fmt.Println(<span class="hljs-string">&quot;add block successfully: &quot;</span>, data)
}
</code></pre>
<p>同理，更新printChain函数</p>
<pre><code class="lang-go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(cli *CLI)</span><span class="hljs-title">printChain</span><span class="hljs-params">()</span></span>  {

    <span class="hljs-comment">//定义迭代器</span>
    <span class="hljs-comment">//it := NewBlockChainIterator(cli.bc)</span>
    bc := GetBlockChainObj()
    it := NewBlockChainIterator(bc)
    <span class="hljs-keyword">for</span> {
        ...
</code></pre>
<p>修改main.go文件如下</p>
<pre><code class="lang-go"><span class="hljs-keyword">package</span> main

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">//bc := NewBlockChain()</span>
    <span class="hljs-comment">//cli := CLI{bc}</span>
    cli := CLI{}
    cli.Run()
</code></pre>
<h1 id="十二、第四次测试"><a name="十二、第四次测试" class="plugin-anchor" href="#十二、第四次测试"><i class="fa fa-link" aria-hidden="true"></i></a>十二、第四次测试</h1>
<p>编译执行</p>
<p><img src="assets/image-20221108133618256.png" alt="image-20221108133618256"></p>
<p>请先删除已有的blockChain.db文件</p>
<h2 id="1-添加命令测试"><a name="1-添加命令测试" class="plugin-anchor" href="#1-添加命令测试"><i class="fa fa-link" aria-hidden="true"></i></a>1. 添加命令测试</h2>
<p>直接进行添加测试，友好提示如下：</p>
<p><img src="assets/image-20221108133626311.png" alt="image-20221108133626311"></p>
<h2 id="2-创建命令测试"><a name="2-创建命令测试" class="plugin-anchor" href="#2-创建命令测试"><i class="fa fa-link" aria-hidden="true"></i></a>2. 创建命令测试</h2>
<p><img src="assets/image-20221108133635824.png" alt="image-20221108133635824"></p>
<p>再次执行创建命令</p>
<p><img src="assets/image-20221108133654633.png" alt="image-20221108133654633"></p>
<h2 id="3再次添加区块测试"><a name="3再次添加区块测试" class="plugin-anchor" href="#3再次添加区块测试"><i class="fa fa-link" aria-hidden="true"></i></a>3.再次添加区块测试</h2>
<p><img src="assets/image-20221108133706911.png" alt="image-20221108133706911"></p>
<p>v3版本完</p>
<h1 id="十三、下节预告"><a name="十三、下节预告" class="plugin-anchor" href="#十三、下节预告"><i class="fa fa-link" aria-hidden="true"></i></a>十三、下节预告</h1>
<p>交易，前方高能，提好裤子</p>

                                
                                </section>
                            
                        </div>
                    </div>
                
            </div>

            
                
                <a href="day2-01-v2挖矿.html" class="navigation navigation-prev " aria-label="Previous page: 第8节:day2-v2挖矿">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="day3-01-交易原理.html" class="navigation navigation-next " aria-label="Next page: 第10节:day3-交易原理">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"第9节:day2-v3存储","level":"1.16.9","depth":2,"next":{"title":"第10节:day3-交易原理","level":"1.16.10","depth":2,"path":"11_精通比特币/day3-01-交易原理.md","ref":"11_精通比特币/day3-01-交易原理.md","articles":[]},"previous":{"title":"第8节:day2-v2挖矿","level":"1.16.8","depth":2,"path":"11_精通比特币/day2-01-v2挖矿.md","ref":"11_精通比特币/day2-01-v2挖矿.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["-search","-lunr","toggle-chapters","page-toc-button","include-codeblock","anchors","js-console"],"pluginsConfig":{"toggle-chapters":{},"page-toc-button":{},"include-codeblock":{"check":false,"edit":false,"lang":"","fixlang":false,"template":"default","theme":"chrome","unindent":false},"anchors":{},"js-console":{},"highlight":{},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"11_精通比特币/day2-02-v3存储.md","mtime":"2022-11-09T02:32:09.183Z","type":"markdown"},"gitbook":{"version":"3.7.3","time":"2023-01-03T05:04:40.251Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-page-toc-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-js-console/console-ui.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

